# Спецификация модуля Collect

## Назначение

Модуль **Collect** — Telegram‑бот, который принимает фото с комментарием и сохраняет их как «срез дня»:

- **1 день = 1 (или несколько) фото(ок)** с комментарием
- Каждое сообщение — «срез дня»
- Данные хранятся в БД и используются для:
  - TG‑канала с фотками
  - семейных досок
  - годовых обзоров
  - AI‑аналитики и отчётов

---

## Модель данных (SQLite)

Таблица **collect_entries**:

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | INTEGER | PK, автоинкремент |
| `user_id` | INTEGER | Внутренний ID пользователя |
| `chat_id` | INTEGER | ID чата в Telegram |
| `message_id` | INTEGER | ID сообщения в Telegram |
| `photo_file_id` | TEXT | Telegram file_id (основной источник) |
| `photo_file_path` | TEXT, NULL | Путь к локальной копии (если скачиваем; опционально) |
| `comment` | TEXT | Подпись/комментарий к фото |
| `created_at` | TEXT/INTEGER | Timestamp записи |
| `tags` | TEXT | Теги через запятую (на будущее) |

---

## Поведение бота (MVP)

1. Бот принимает **фото с подписью** (caption)
2. Из массива `photo_sizes` выбирает **самое большое** фото и сохраняет его `file_id`
3. Сохраняет запись в `collect_entries`
4. Отвечает подтверждением: «Записал твой день»

---

## Collect → TG‑канал (реализовано)

Если в `.env` задан `CHANNEL_ID` (@username или -100xxxxxxxxxx), бот публикует фото в канал.

- **Мгновенно** — если `POST_SCHEDULE_TIME` пустой.
- **Отложенно** — если задан `POST_SCHEDULE_TIME=20:00` (HH:MM): фото копятся, публикуются раз в день в указанное время.
- `/postnow` — опубликовать накопленные посты сейчас.
- `/postat 18:30` — опубликовать в указанное время (HH:MM).
- `/mylist` — список отложенных фото.
- `/cancel` — отменить последнее отложенное фото; `/cancel 3` — отменить #3 из списка.
- **Заготовки:** если до 23:00 не было ни одного фото за день — бот постит в канал одну из заготовок и пишет, сколько осталось. `/addstock` — добавить заготовки (фото по одному, закончить — /done), `/stock` — сколько заготовок.

**Настройка:** добавь бота @CollectMyDay_bot админом в канал с правом «Post messages».

---

## Будущие функции (backlog)

- `/export` — выгрузка за период
- `/board` — подготовка семейной доски
- Флажок «публиковать в открытый канал / нет»
- Связь с Notion или другой внешней системой Avatar

---

## Связанные файлы

- Код бота: `bot/collect_bot.py`
- Схема БД: `db/init.sql` или скрипт инициализации
- Конфиг: `config/settings.py`, `.env`
